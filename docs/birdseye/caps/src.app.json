{
  "id": "src/app.py",
  "role": "entrypoint",
  "summary": "Chainlit イベントハンドラと運用 API を集約し、履歴トリミング・マルチステップ実行・LLM 呼び出し・メトリクス公開を統括する中核エントリポイント。",
  "public_api": [
    "METRICS_REGISTRY",
    "get_provider()",
    "apply_settings()",
    "on_message()"
  ],
  "deps_out": [
    "src/core_ext/context_trimmer.py",
    "src/core_ext/logging.py",
    "src/core_ext/multistep.py",
    "src/core_ext/persona_compiler.py",
    "src/core_ext/prethought.py",
    "src/providers/google_gemini_client.py",
    "src/providers/openai_client.py"
  ],
  "deps_in": [
    "src/core_ext/context_trimmer.py",
    "src/core_ext/logging.py",
    "src/core_ext/persona_compiler.py",
    "src/core_ext/prethought.py",
    "src/providers/google_gemini_client.py",
    "src/providers/openai_client.py"
  ],
  "tests": [
    "pytest tests/app/test_get_provider.py",
    "pytest tests/app/test_logging.py",
    "pytest tests/app/test_metrics_healthz.py"
  ],
  "risks": [
    "Chainlit フックと FastAPI ルータの順序を壊すと /metrics が重複登録される",
    "OPENAI_API_KEY 未設定時はプロバイダ初期化が失敗する"
  ],
  "generated_at": "00002"
}
